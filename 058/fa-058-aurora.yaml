AWSTemplateFormatVersion: 2010-09-09

Parameters:
  AvailabilityZone:
    Type: String

  DBClusterIdentifier:
    Type: String
    
  DBEngine:
    Type: String
    
  DBEngineVersion:
    Type: String
    
  DBInstanceClass:
    Type: String
    
  DBInstanceIdentifier:
    Type: String
    
  DBMasterUsername:
    Type: String
    
  DBMasterUserPassword:
    Type: String
    
  DBName:
    Type: String
    
  DBSecurityGroup:
    Type: String

  PrivateSubnet2:
    Type: String
    
  PrivateSubnet3:
    Type: String


Resources:
  DBSubnetGroup:
    Type: AWS::RDS::DBSubnetGroup
    Properties:
      DBSubnetGroupName: dbsubnetgroup
      DBSubnetGroupDescription: test subnet group
      SubnetIds:
        - !Ref PrivateSubnet2
        - !Ref PrivateSubnet3
        
  DBCluster:
    Type: AWS::RDS::DBCluster
    Properties:
      DatabaseName: !Ref DBName
      DBClusterIdentifier: !Ref DBClusterIdentifier
      DBSubnetGroupName: !Ref DBSubnetGroup
      Engine: !Ref DBEngine
      #Engine: aurora-mysql
      EngineMode: serverless
      EngineVersion: !Ref DBEngineVersion
      #EngineVersion: 8.0.mysql_aurora.3.02.0
      MasterUsername: !Ref DBMasterUsername
      MasterUserPassword: !Ref DBMasterUserPassword
      StorageEncrypted: true
      VpcSecurityGroupIds:
        - !Ref DBSecurityGroup
        
  #DBInstance:
  #  Type: AWS::RDS::DBInstance
  #  Properties:
  #    DBClusterIdentifier: !Ref DBCluster
  #    DBSubnetGroupName: !Ref DBSubnetGroup
  #    #DBParameterGroupName: !Ref DBParameterGroup
  #    DBInstanceIdentifier: !Ref DBInstanceIdentifier
  #    DBInstanceClass: !Ref DBInstanceClass
  #    Engine: !Ref DBEngine
  #    #Engine: aurora-mysql
  #    AvailabilityZone: !Sub "${AWS::Region}${AvailabilityZone}"
  #    PubliclyAccessible: false
  #    #PromotionTier: 1