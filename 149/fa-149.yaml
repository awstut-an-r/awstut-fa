AWSTemplateFormatVersion: 2010-09-09

Parameters:
  TemplateBucketName:
    Type: String
    Default: awstut-bucket
    
  Prefix:
    Type: String
    Default: fa-149

  ProjectEnvironmentComputeType:
    Type: String
    Default: BUILD_LAMBDA_1GB
    
  ProjectEnvironmentImage:
    Type: String
    Default: aws/codebuild/amazonlinux-aarch64-lambda-standard:python3.12
    
  ProjectEnvironmentType:
    Type: String
    Default: ARM_LAMBDA_CONTAINER


Resources:
  S3Stack:
    Type: AWS::CloudFormation::Stack
    Properties:
      TemplateURL: !Sub "https://${TemplateBucketName}.s3.${AWS::Region}.amazonaws.com/${Prefix}/${Prefix}-s3.yaml"
      Parameters:
        #Handler: !Ref LambdaHandler
        Prefix: !Ref Prefix
        #Runtime: !Ref LambdaRuntime
  
  CodeStack:
    Type: AWS::CloudFormation::Stack
    DependsOn:
      - S3Stack
      #- SSMStack
      #- ECRStack
      #- FargateStack
      #- LambdaStack
    Properties:
      TemplateURL: !Sub "https://${TemplateBucketName}.s3.${AWS::Region}.amazonaws.com/${Prefix}/${Prefix}-code.yaml"
      Parameters:
        #BranchName: !Ref BranchName
        #BucketArn: !GetAtt S3Stack.Outputs.BucketArn
        BucketName: !GetAtt S3Stack.Outputs.BucketName
        #ContainerName: !Ref ContainerName
        #ECRRepositoryName: !GetAtt ECRStack.Outputs.ECRRepositoryName
        #ECSClusterName: !GetAtt FargateStack.Outputs.ECSClusterName
        #ECSFunctionName: !GetAtt LambdaStack.Outputs.ECSFunctionName
        #ECSServiceName: !GetAtt FargateStack.Outputs.ECSServiceName
        #ImageDefinitionFileName: !Ref ImageDefinitionFileName
        #PipelineBuildArtifact: BuildArtifact
        #PipelineSourceArtifact: SourceArtifact
        Prefix: !Ref Prefix
        ProjectEnvironmentComputeType: !Ref ProjectEnvironmentComputeType
        ProjectEnvironmentImage: !Ref ProjectEnvironmentImage
        ProjectEnvironmentType: !Ref ProjectEnvironmentType
        #ReportName: !Ref ReportName
        #SSMParameterDockerHubPassword: !GetAtt SSMStack.Outputs.SSMParameterDockerHubPassword
        #SSMParameterDockerHubUsername: !GetAtt SSMStack.Outputs.SSMParameterDockerHubUsername
        #TopicArn: !GetAtt SNSStack.Outputs.TopicArn
